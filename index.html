<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>‚ö° Neon Runner WOW - Ultra Fluid 60+ FPS | LIPA Studios</title>
    <meta name="description" content="Play Neon Runner WOW, the most fluid endless runner! 60+ FPS, epic effects, mega combos. Ultra optimized HTML5 game by LIPA Studios.">
    
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-633RQLC6T0"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-633RQLC6T0');
        
        window.trackDonationClick = function(amount = 'custom') {
            gtag('event', 'donation_click', {
                source: 'neon_runner_wow',
                amount: amount,
                value: parseFloat(amount) || 1
            });
        };
    </script>
    
    <!-- Google AdSense (deshabilitado hasta aprobaci√≥n) -->
    <!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4837743291717475" crossorigin="anonymous"></script> -->
    <!-- Consent Mode v2 + Banner -->
    <script>
        (function(){
          window.dataLayer = window.dataLayer || [];
          window.gtag = window.gtag || function(){ dataLayer.push(arguments); };

          // Default to denied until user chooses
          gtag('consent', 'default', {
            ad_storage: 'denied',
            analytics_storage: 'denied',
            ad_user_data: 'denied',
            ad_personalization: 'denied'
          });

          const CHOICE_KEY = 'lipa_consent_v2';
          const saved = (function(){ try { return JSON.parse(localStorage.getItem(CHOICE_KEY)||'null'); } catch(e){ return null; } })();
          if (saved && saved.status) {
            apply(saved.status);
            return;
          }

          // Banner UI
          const bar = document.createElement('div');
          bar.style.cssText = 'position:fixed;left:0;right:0;bottom:0;z-index:100000;background:rgba(0,0,20,.95);border-top:2px solid #00ffff;color:#e8f6ff;padding:14px;display:flex;gap:12px;align-items:center;justify-content:center;flex-wrap:wrap;font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial,sans-serif;';
          bar.innerHTML = '<span style="max-width:680px;text-align:center">Usamos Google Analytics y Google AdSense. Puedes aceptar o rechazar. M√°s info en <a href="/privacy.html" style="color:#00ffff">Privacidad</a>.</span>'+
            '<div style="display:flex;gap:10px;flex-wrap:wrap">'+
            '<button id="lipa-accept" style="background:#00ffff;color:#000;padding:10px 16px;border:none;border-radius:8px;font-weight:700;cursor:pointer">ACEPTAR</button>'+
            '<button id="lipa-reject" style="background:#444;color:#fff;padding:10px 16px;border:1px solid #666;border-radius:8px;font-weight:700;cursor:pointer">RECHAZAR</button>'+
            '</div>';
          document.addEventListener('DOMContentLoaded', function(){ document.body.appendChild(bar); });

          // Mini footer contacto (aparece en todos los sitios)
          document.addEventListener('DOMContentLoaded', function(){
            try {
              var mini = document.createElement('div');
              mini.className = 'site-mini-footer';
              mini.style.cssText = 'position:fixed;bottom:6px;right:8px;background:rgba(0,0,0,0.6);border:1px solid #00ffff;border-radius:8px;padding:6px 10px;font:12px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;z-index:10000';
              mini.innerHTML = '<span style="color:#00ffff">Contacto:</span> <a href="mailto:lipastudios4@gmail.com" style="color:#ffff00;text-decoration:none">lipastudios4@gmail.com</a>';
              document.body.appendChild(mini);
            } catch(e) {}
          });

          function store(status){ try { localStorage.setItem(CHOICE_KEY, JSON.stringify({ status, ts: Date.now() })); } catch(e){} }

          function apply(status){
            const granted = status === 'granted';
            gtag('consent', 'update', {
              ad_storage: granted ? 'granted' : 'denied',
              analytics_storage: granted ? 'granted' : 'denied',
              ad_user_data: granted ? 'granted' : 'denied',
              ad_personalization: granted ? 'granted' : 'denied'
            });
          }

          function choose(status){
            apply(status);
            store(status);
            if (bar && bar.parentNode) bar.parentNode.removeChild(bar);
          }

          bar.addEventListener('click', function(e){
            if (e.target && e.target.id === 'lipa-accept') choose('granted');
            if (e.target && e.target.id === 'lipa-reject') choose('denied');
          });
        })();
    </script>
    <!-- Leaderboard System - INLINED TO BYPASS DECODING ISSUES -->
    <script>
        // LIPA STUDIOS - UNIFIED GLOBAL LEADERBOARD SYSTEM
        // Sistema unificado de clasificacion global para todos los juegos

        class UnifiedGlobalLeaderboard {
            constructor(gameName) {
                this.gameName = gameName;
                this.apiUrl = 'https://api.jsonbin.io/v3/b/68ded27743b1c97be95840b3'; // Tu Bin ID
                this.apiKey = '$2a$10$wIVZHoUqVwKQR2K1LDyPueJYW0x2laHFZz4WztFqEo7WAyAvlx8ti'; // Tu Master Key
                this.today = this.getTodayString();
                this.currentUser = this.loadCurrentUser();
                this.leaderboard = [];
                this.isLoading = false;
            }

            getTodayString() {
                return new Date().toISOString().split('T')[0]; // YYYY-MM-DD
            }

            loadCurrentUser() {
                try {
                    // Intentar cargar usuario espec√≠fico del juego
                    let user = JSON.parse(localStorage.getItem(`lipa_user_${this.gameName}`) || 'null');
                    
                    // Si no hay usuario espec√≠fico, intentar cargar usuario global
                    if (!user) {
                        user = JSON.parse(localStorage.getItem('lipa_user_global') || 'null');
                    }
                    
                    return user;
                } catch (e) {
                    return null;
                }
            }

            saveCurrentUser() {
                try {
                    // Guardar usuario espec√≠fico del juego
                    localStorage.setItem(`lipa_user_${this.gameName}`, JSON.stringify(this.currentUser));
                    // Tambi√©n guardar como usuario global para sincronizaci√≥n
                    localStorage.setItem('lipa_user_global', JSON.stringify(this.currentUser));
                } catch (e) {
                    console.error('Error saving user:', e);
                }
            }

            setUserName(name) {
                this.currentUser = {
                    name: name.trim().substring(0, 15),
                    joinDate: this.currentUser?.joinDate || new Date().toISOString(),
                    totalGames: this.currentUser?.totalGames || 0,
                    bestScore: this.currentUser?.bestScore || 0,
                    deviceId: this.getDeviceId()
                };
                this.saveCurrentUser();
            }

            getDeviceId() {
                let deviceId = localStorage.getItem('device_id');
                if (!deviceId) {
                    deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('device_id', deviceId);
                }
                return deviceId;
            }

            // API CALLS TO JSONBIN
            async fetchLeaderboard() {
                if (this.isLoading) return;
                
                this.isLoading = true;
                console.log('üîÑ Cargando leaderboard para:', this.gameName, 'fecha:', this.today);
                
                try {
                    const response = await fetch(`${this.apiUrl}/latest`, {
                        headers: {
                            'X-Master-Key': this.apiKey,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log('üìä Datos recibidos de JSONBin:', data);
                        
                        const allScores = data.record || {};
                        const todayScores = allScores[this.today] || [];
                        console.log('üìÖ Puntuaciones de hoy:', todayScores);
                        
                        // Filtrar solo las puntuaciones de este juego
                        this.leaderboard = todayScores
                            .filter(score => score.game === this.gameName)
                            .sort((a, b) => b.score - a.score)
                            .slice(0, 50);
                        
                        console.log('‚úÖ Leaderboard cargado desde la nube:', this.leaderboard.length, 'puntuaciones para', this.gameName);
                        console.log('üèÜ Puntuaciones encontradas:', this.leaderboard);
                    } else {
                        console.error('‚ùå Error cargando leaderboard:', response.status, response.statusText);
                        this.leaderboard = [];
                    }
                } catch (error) {
                    console.error('‚ùå Error de conexi√≥n:', error);
                    this.leaderboard = [];
                } finally {
                    this.isLoading = false;
                }
            }

            async fetchAllGamesLeaderboard() {
                if (this.isLoading) return;
                
                this.isLoading = true;
                try {
                    const response = await fetch(`${this.apiUrl}/latest`, {
                        headers: {
                            'X-Master-Key': this.apiKey,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        const allScores = data.record || {};
                        const todayScores = allScores[this.today] || [];
                        
                        // Obtener todas las puntuaciones de todos los juegos
                        this.allGamesLeaderboard = todayScores
                            .sort((a, b) => b.score - a.score)
                            .slice(0, 100);
                        
                        console.log('‚úÖ Leaderboard global cargado:', this.allGamesLeaderboard.length, 'puntuaciones');
                    } else {
                        console.error('‚ùå Error cargando leaderboard global:', response.status);
                        this.allGamesLeaderboard = [];
                    }
                } catch (error) {
                    console.error('‚ùå Error de conexi√≥n:', error);
                    this.allGamesLeaderboard = [];
                } finally {
                    this.isLoading = false;
                }
            }

            async submitScore(score, level = 1, combo = 0) {
                console.log('üéØ Enviando puntuaci√≥n:', { score, level, combo, game: this.gameName, user: this.currentUser });
                
                if (!this.currentUser) {
                    console.log('‚ö†Ô∏è No hay usuario, mostrando prompt de nombre');
                    this._pendingSubmission = { score, level, combo };
                    this.showNamePrompt(true);
                    return false;
                }

                const scoreData = {
                    name: this.currentUser.name,
                    score: score,
                    level: level,
                    combo: combo,
                    game: this.gameName,
                    date: this.today,
                    device_id: this.getDeviceId(),
                    timestamp: new Date().toISOString()
                };
                
                console.log('üì§ Datos de puntuaci√≥n a enviar:', scoreData);

                try {
                    // Primero obtener los datos actuales
                    const response = await fetch(`${this.apiUrl}/latest`, {
                        headers: {
                            'X-Master-Key': this.apiKey,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        const allScores = data.record || {};
                        
                        // Inicializar array para hoy si no existe
                        if (!allScores[this.today]) {
                            allScores[this.today] = [];
                        }
                        
                        // Agregar nueva puntuaci√≥n
                        allScores[this.today].push(scoreData);
                        
                        // Ordenar y mantener solo top 50
                        allScores[this.today] = allScores[this.today]
                            .sort((a, b) => b.score - a.score)
                            .slice(0, 50);
                        
                        // Actualizar en JSONBin
                        const updateResponse = await fetch(this.apiUrl, {
                            method: 'PUT',
                            headers: {
                                'X-Master-Key': this.apiKey,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(allScores)
                        });

                        if (updateResponse.ok) {
                            console.log('‚úÖ Puntuaci√≥n enviada a la nube');
                            
                            // Actualizar stats del usuario
                            this.currentUser.totalGames++;
                            if (score > this.currentUser.bestScore) {
                                this.currentUser.bestScore = score;
                            }
                            this.saveCurrentUser();

                            // Recargar leaderboard
                            await this.fetchLeaderboard();
                            
                            // Mostrar ranking
                            this.showRanking(scoreData);
                            return true;
                        } else {
                            console.error('‚ùå Error actualizando puntuaci√≥n:', updateResponse.status);
                            alert('Error al enviar puntuaci√≥n. Int√©ntalo de nuevo.');
                            return false;
                        }
                    } else {
                        console.error('‚ùå Error obteniendo datos:', response.status);
                        alert('Error al obtener datos. Int√©ntalo de nuevo.');
                        return false;
                    }
                } catch (error) {
                    console.error('‚ùå Error de conexi√≥n:', error);
                    alert('Sin conexi√≥n a internet. La puntuaci√≥n se guardar√° cuando tengas conexi√≥n.');
                    return false;
                }
            }

            getRanking() {
                return this.leaderboard.slice(0, 10); // Top 10
            }

            getUserRank() {
                if (!this.currentUser) return null;
                
                const userIndex = this.leaderboard.findIndex(
                    entry => entry.name === this.currentUser.name
                );
                
                return userIndex >= 0 ? userIndex + 1 : null;
            }

            showNamePrompt(autoSubmitAfter = false) {
                const overlay = document.createElement('div');
                overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100000; display: flex; align-items: center; justify-content: center; font-family: system-ui;';
                overlay.innerHTML = '<div style="background: linear-gradient(135deg, #1a1a2e, #16213e); border: 2px solid #00ffff; border-radius: 15px; padding: 30px; text-align: center; max-width: 400px; width: 90%;"><h2 style="color: #00ffff; margin-bottom: 20px;">TROPHY Unete al Ranking Global!</h2><p style="color: #fff; margin-bottom: 20px;">Elige tu nombre para competir con jugadores de todo el mundo</p><input type="text" id="username-input" placeholder="Tu nombre (max 15 caracteres)" style="width: 100%; padding: 12px; margin-bottom: 20px; border: 2px solid #00ffff; background: rgba(0,0,0,0.5); color: #fff; border-radius: 8px; font-size: 16px;" maxlength="15"><div style="display: flex; gap: 10px; justify-content: center;"><button id="save-name" style="background: #00ffff; color: #000; padding: 12px 24px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">GUARDAR</button><button id="skip-name" style="background: #666; color: #fff; padding: 12px 24px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">SALTAR</button></div></div>';
                document.body.appendChild(overlay);
                
                const input = overlay.querySelector('#username-input');
                const saveBtn = overlay.querySelector('#save-name');
                const skipBtn = overlay.querySelector('#skip-name');
                
                input.focus();
                
                saveBtn.onclick = () => {
                    const name = input.value.trim();
                    if (name.length >= 2) {
                        this.setUserName(name);
                        document.body.removeChild(overlay);
                        if (autoSubmitAfter && this._pendingSubmission) {
                            const { score, level, combo } = this._pendingSubmission;
                            this._pendingSubmission = null;
                            this.submitScore(score, level, combo);
                        }
                    } else {
                        alert('El nombre debe tener al menos 2 caracteres');
                    }
                };
                
                skipBtn.onclick = () => {
                    if (!this.currentUser) this.setUserName('Anonimo');
                    document.body.removeChild(overlay);
                    if (autoSubmitAfter && this._pendingSubmission) {
                        const { score, level, combo } = this._pendingSubmission;
                        this._pendingSubmission = null;
                        this.submitScore(score, level, combo);
                    }
                };
                
                input.onkeypress = (e) => { if (e.key === 'Enter') saveBtn.click(); };
            }

            showRanking(scoreData) {
                const ranking = this.getRanking();
                const userRank = this.getUserRank();
                const overlay = document.createElement('div');
                overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100000; display: flex; align-items: center; justify-content: center; font-family: system-ui;';
                
                let rankingHTML = '';
                ranking.forEach((entry, index) => {
                    const isCurrentUser = entry.name === this.currentUser.name;
                    const medal = index === 0 ? 'GOLD' : index === 1 ? 'SILVER' : index === 2 ? 'BRONZE' : 'MEDAL';
                    rankingHTML += '<div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; margin: 4px 0; border-radius: 8px; background: ' + (isCurrentUser ? 'rgba(0,255,255,0.2)' : 'rgba(255,255,255,0.1)') + '; border: ' + (isCurrentUser ? '2px solid #00ffff' : '1px solid #333') + ';"><span style="color: #fff; font-weight: bold;">' + medal + ' #' + (index + 1) + '</span><span style="color: ' + (isCurrentUser ? '#00ffff' : '#fff') + '; font-weight: bold;">' + entry.name + '</span><span style="color: #ffff00; font-weight: bold;">' + entry.score.toLocaleString() + '</span></div>';
                });
                
                overlay.innerHTML = '<div style="background: linear-gradient(135deg, #1a1a2e, #16213e); border: 2px solid #00ffff; border-radius: 15px; padding: 30px; text-align: center; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;"><h2 style="color: #00ffff; margin-bottom: 20px;">TROPHY Ranking Global Diario - ' + this.gameName + '</h2><p style="color: #fff; margin-bottom: 20px;">Tu posicion: #' + (userRank || 'No clasificado') + '</p><div style="margin-bottom: 20px;">' + rankingHTML + '</div><div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;"><button id="refresh-ranking" style="background: #1da1f2; color: #fff; padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">REFRESH Actualizar</button><button id="all-games-ranking" style="background: #ff6b6b; color: #fff; padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">TODOS LOS JUEGOS</button><button id="close-ranking" style="background: #00ffff; color: #000; padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">Cerrar</button></div></div>';
                document.body.appendChild(overlay);
                
                const refreshBtn = overlay.querySelector('#refresh-ranking');
                const allGamesBtn = overlay.querySelector('#all-games-ranking');
                const closeBtn = overlay.querySelector('#close-ranking');
                
                refreshBtn.onclick = async () => {
                    refreshBtn.textContent = 'Cargando...';
                    await this.fetchLeaderboard();
                    document.body.removeChild(overlay);
                    this.showRanking(scoreData);
                };
                
                allGamesBtn.onclick = async () => {
                    document.body.removeChild(overlay);
                    await this.showAllGamesLeaderboard();
                };
                
                closeBtn.onclick = () => document.body.removeChild(overlay);
            }

            async showAllGamesLeaderboard() {
                await this.fetchAllGamesLeaderboard();
                
                const overlay = document.createElement('div');
                overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100000; display: flex; align-items: center; justify-content: center; font-family: system-ui;';
                
                let rankingHTML = '';
                this.allGamesLeaderboard.slice(0, 20).forEach((entry, index) => {
                    const isCurrentUser = entry.name === this.currentUser?.name;
                    const medal = index === 0 ? 'GOLD' : index === 1 ? 'SILVER' : index === 2 ? 'BRONZE' : 'MEDAL';
                    const gameIcon = this.getGameIcon(entry.game);
                    rankingHTML += '<div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; margin: 4px 0; border-radius: 8px; background: ' + (isCurrentUser ? 'rgba(0,255,255,0.2)' : 'rgba(255,255,255,0.1)') + '; border: ' + (isCurrentUser ? '2px solid #00ffff' : '1px solid #333') + ';"><span style="color: #fff; font-weight: bold;">' + medal + ' #' + (index + 1) + '</span><span style="color: ' + (isCurrentUser ? '#00ffff' : '#fff') + '; font-weight: bold;">' + entry.name + '</span><span style="color: #ff6b6b; font-weight: bold;">' + gameIcon + '</span><span style="color: #ffff00; font-weight: bold;">' + entry.score.toLocaleString() + '</span></div>';
                });
                
                overlay.innerHTML = '<div style="background: linear-gradient(135deg, #1a1a2e, #16213e); border: 2px solid #00ffff; border-radius: 15px; padding: 30px; text-align: center; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto;"><h2 style="color: #00ffff; margin-bottom: 20px;">TROPHY Ranking Global - Todos los Juegos</h2><p style="color: #fff; margin-bottom: 20px;">Clasificaci√≥n unificada de todos los juegos LIPA Studios</p><div style="margin-bottom: 20px;">' + rankingHTML + '</div><div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;"><button id="refresh-all-ranking" style="background: #1da1f2; color: #fff; padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">REFRESH Actualizar</button><button id="close-all-ranking" style="background: #00ffff; color: #000; padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">Cerrar</button></div></div>';
                document.body.appendChild(overlay);
                
                const refreshBtn = overlay.querySelector('#refresh-all-ranking');
                const closeBtn = overlay.querySelector('#close-all-ranking');
                
                refreshBtn.onclick = async () => {
                    refreshBtn.textContent = 'Cargando...';
                    await this.fetchAllGamesLeaderboard();
                    document.body.removeChild(overlay);
                    await this.showAllGamesLeaderboard();
                };
                
                closeBtn.onclick = () => document.body.removeChild(overlay);
            }

            getGameIcon(gameName) {
                const icons = {
                    'neon-runner-wow': 'üèÉ‚Äç‚ôÇÔ∏è',
                    'stack-tower-neon': 'üìö',
                    'neon-beat-stage': 'üéµ',
                    'neon-lab-physics-wow': 'üß™',
                    'stack-tower-wow': 'üìö',
                    'neon-beat-wow': 'üéµ',
                    'neon-runner': 'üèÉ‚Äç‚ôÇÔ∏è',
                    'neon-lab-physics': 'üß™'
                };
                return icons[gameName] || 'üéÆ';
            }

            async showLeaderboard() {
                await this.fetchLeaderboard();
                this.showRanking({ name: this.currentUser?.name || 'Anonimo', score: 0 });
            }

            getStats() {
                if (!this.currentUser) return null;
                return {
                    name: this.currentUser.name,
                    totalGames: this.currentUser.totalGames,
                    bestScore: this.currentUser.bestScore,
                    currentRank: this.getUserRank(),
                    joinDate: this.currentUser.joinDate,
                    badgesCount: 0,
                    recentBadges: []
                };
            }
        }

        // INTEGRACION CON JUEGOS
        window.UnifiedGlobalLeaderboard = UnifiedGlobalLeaderboard;
        window.GlobalLeaderboard = UnifiedGlobalLeaderboard; // Mantener compatibilidad
        window.DailyLeaderboard = UnifiedGlobalLeaderboard; // Mantener compatibilidad

        // Funcion helper para integrar facilmente
        window.initLeaderboard = function(gameName) {
            return new UnifiedGlobalLeaderboard(gameName);
        };

        // Funcion para mostrar ranking desde cualquier parte
        window.showLeaderboard = function(gameName) {
            const lb = new UnifiedGlobalLeaderboard(gameName);
            lb.showLeaderboard();
        };

        // Funcion para mostrar ranking de todos los juegos
        window.showAllGamesLeaderboard = function() {
            const lb = new UnifiedGlobalLeaderboard('unified');
            lb.showAllGamesLeaderboard();
        };

        console.log('‚úÖ LIPA Unified Global Leaderboard System loaded inline!');
    </script>
    
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="iyEAsCuQ7tncHUvc1e09D9gDHOt0nzPQByhGu1xzq54" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #000 0%, #111 50%, #000 100%);
            color: #00FFFF;
            overflow: hidden;
            height: 100vh;
            user-select: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        
        #gameCanvas {
            display: block;
            background: linear-gradient(180deg, #000 0%, #111 50%, #000 100%);
            cursor: pointer;
            will-change: transform;
        }
        
        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        .score-display {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
            font-weight: bold;
            color: #00FFFF;
            text-shadow: 0 0 10px #00FFFF;
            will-change: transform;
        }
        
        .combo-display {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 20px;
            font-weight: bold;
            color: #FF00FF;
            text-shadow: 0 0 15px #FF00FF;
            will-change: transform;
        }
        
        .fps-display {
            position: absolute;
            top: 60px;
            left: 20px;
            font-size: 14px;
            color: #00FF00;
            font-family: monospace;
        }
        
        .menu-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #000 0%, #111 50%, #000 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
        }
        
        .game-title {
            font-size: 48px;
            font-weight: bold;
            color: #00FFFF;
            text-shadow: 0 0 20px #00FFFF;
            margin-bottom: 20px;
            animation: titlePulse 2s infinite;
        }
        
        .wow-subtitle {
            font-size: 24px;
            color: #FF00FF;
            text-shadow: 0 0 15px #FF00FF;
            margin-bottom: 40px;
            animation: subtitleGlow 1.5s infinite alternate;
        }
        
        .start-button {
            padding: 15px 30px;
            font-size: 20px;
            font-weight: bold;
            background: linear-gradient(45deg, #00FFFF, #FF00FF);
            color: #000;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px #00FFFF;
            will-change: transform;
        }
        
        .start-button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px #FF00FF;
        }
        
        .donate-button {
            padding: 15px 30px;
            font-size: 20px;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6600, #ffff00);
            color: #000;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px #ff6600;
            will-change: transform;
            text-decoration: none;
            display: inline-block;
            margin-top: 15px;
        }
        
        .donate-button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px #ff6600;
        }
        
        .game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 30;
        }
        
        .game-over-title {
            font-size: 36px;
            color: #FF0000;
            text-shadow: 0 0 15px #FF0000;
            margin-bottom: 20px;
        }
        
        .final-score {
            font-size: 24px;
            color: #00FFFF;
            margin-bottom: 30px;
        }
        
        .restart-button {
            padding: 12px 25px;
            font-size: 18px;
            background: linear-gradient(45deg, #FF00FF, #00FFFF);
            color: #000;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .restart-button:hover {
            transform: scale(1.05);
        }
        
        /* AdSense Banners */
        .ad-banner {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #00FFFF;
            z-index: 5;
        }
        
        .top-banner {
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 320px;
            height: 50px;
        }
        
        .bottom-banner {
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 320px;
            height: 50px;
        }
        
        .side-banner {
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 120px;
            height: 600px;
            transition: opacity 0.3s ease;
        }
        
        /* OCULTAR BANNER DURANTE EL JUEGO - NUNCA MOSTRAR */
        .game-screen .side-banner {
            display: none !important;
        }
        
        /* MOSTRAR BANNER SOLO EN MEN√ö Y GAME OVER */
        .menu-screen .side-banner,
        .gameover-screen .side-banner {
            display: block !important;
            opacity: 1;
            pointer-events: auto;
        }
        
        /* Animations */
        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes subtitleGlow {
            0% { text-shadow: 0 0 15px #FF00FF; }
            100% { text-shadow: 0 0 25px #FF00FF, 0 0 35px #FF00FF; }
        }
        
        @keyframes particleFloat {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }
        
        @keyframes screenShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .screen-shake {
            animation: screenShake 0.3s ease-in-out;
        }
        
        /* Leaderboard Styles */
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            margin: 5px 0;
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid #00FFFF;
            border-radius: 8px;
            color: #00FFFF;
            font-size: 16px;
            font-weight: bold;
        }
        
        .leaderboard-item.current-user {
            background: rgba(255, 215, 0, 0.2);
            border-color: #FFD700;
            color: #FFD700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
        
        .leaderboard-item .rank {
            width: 30px;
            font-size: 18px;
        }
        
        .leaderboard-item .medal {
            width: 30px;
            font-size: 20px;
            text-align: center;
        }
        
        .leaderboard-item .username {
            flex: 1;
            margin: 0 10px;
            text-align: left;
        }
        
        .leaderboard-item .score {
            width: 80px;
            text-align: right;
            color: #00FF00;
        }
        
        .leaderboard-item .level {
            width: 60px;
            text-align: right;
            color: #FF00FF;
            font-size: 14px;
        }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            .game-title { font-size: 36px; }
            .wow-subtitle { font-size: 18px; }
            .start-button { padding: 12px 24px; font-size: 18px; }
            .side-banner { display: none; }
            
            /* Mobile game area */
            #gameCanvas {
                touch-action: manipulation;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                user-select: none;
            }
            
            /* Mobile UI */
            .score-display { font-size: 20px; top: 10px; left: 10px; }
            .combo-display { font-size: 18px; top: 10px; right: 10px; }
            .fps-display { font-size: 12px; top: 40px; left: 10px; }
            
            /* Mobile buttons */
            .start-button, .restart-button {
                padding: 15px 25px;
                font-size: 18px;
                min-height: 50px;
            }
        }
        
        /* Extra small screens */
        @media (max-width: 480px) {
            .game-title { font-size: 28px; }
            .wow-subtitle { font-size: 16px; }
            .score-display { font-size: 18px; }
            .combo-display { font-size: 16px; }
            .start-button, .restart-button {
                padding: 12px 20px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- Global Header / Navigation -->
    <header style="position:relative; z-index:100; background:rgba(0,0,0,0.75); border-bottom:2px solid #00ffff;">
        <nav style="max-width:1100px; margin:0 auto; padding:12px 16px; display:flex; align-items:center; gap:16px; flex-wrap:wrap; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;">
            <a href="/" style="color:#00ffff; text-decoration:none; font-weight:800; letter-spacing:.5px;">LIPA Studios</a>
            <a href="/" style="color:#e8f6ff; text-decoration:none;">Inicio</a>
            <a href="/games.html" style="color:#e8f6ff; text-decoration:none;">Juegos</a>
            <a href="/about.html" style="color:#e8f6ff; text-decoration:none;">About</a>
            <a href="/contact.html" style="color:#e8f6ff; text-decoration:none;">Contacto</a>
            <span style="flex:1 1 auto"></span>
            <a href="/privacy.html" style="color:#00ffff; text-decoration:none;">Privacidad</a>
            <a href="/terms.html" style="color:#00ffff; text-decoration:none;">T√©rminos</a>
        </nav>
    </header>
    <div class="game-container">
        <canvas id="gameCanvas"></canvas>
        
        <div class="ui-overlay">
            <div class="score-display" id="scoreDisplay">SCORE: 0</div>
            <div class="combo-display" id="comboDisplay">COMBO: 1x</div>
            <div class="fps-display" id="fpsDisplay">FPS: 60</div>
        </div>
        
        <div class="menu-screen" id="menuScreen">
            <h1 class="game-title">‚ö° NEON RUNNER WOW</h1>
            <p class="wow-subtitle">Ultra Fluid 60+ FPS Experience</p>
            <button class="start-button" onclick="startGame()">üöÄ START RUNNING</button>
            <button class="start-button" onclick="showLeaderboard('neon-runner-wow')" style="background: linear-gradient(45deg, #FFD700, #FFA500); margin-top: 10px;">üèÜ RANKING</button>
            <div class="donation-section">
                <h3 style="color: #FFFF00; margin-bottom: 15px;">üíñ ¬°Apoya el desarrollo!</h3>
                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <a href="https://paypal.me/lipastudios/0.50" target="_blank" onclick="trackDonationClick('0.50')" style="padding: 12px 20px; background: linear-gradient(45deg, #4CAF50, #8BC34A); color: white; font-weight: bold; border-radius: 8px; text-decoration: none; font-size: 14px;">‚òï 0,50‚Ç¨</a>
                    <a href="https://paypal.me/lipastudios/2.00" target="_blank" onclick="trackDonationClick('2.00')" style="padding: 12px 20px; background: linear-gradient(45deg, #FF9800, #FFC107); color: white; font-weight: bold; border-radius: 8px; text-decoration: none; font-size: 14px;">üçï 2‚Ç¨</a>
                    <a href="https://paypal.me/lipastudios/5.00" target="_blank" onclick="trackDonationClick('5.00')" style="padding: 12px 20px; background: linear-gradient(45deg, #E91E63, #F06292); color: white; font-weight: bold; border-radius: 8px; text-decoration: none; font-size: 14px;">üéÆ 5‚Ç¨</a>
                </div>
            </div>
        </div>
        
        <div class="game-over-screen" id="gameOverScreen">
            <h2 class="game-over-title">GAME OVER</h2>
            <div class="final-score" id="finalScore">SCORE: 0</div>
            <div style="margin-top: 20px;">
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #FFFF00; margin-bottom: 15px;">üíñ ¬°Apoya el desarrollo!</h3>
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px;">
                        <a href="https://paypal.me/lipastudios/0.50" target="_blank" onclick="trackDonationClick('0.50')" style="padding: 12px 20px; background: linear-gradient(45deg, #4CAF50, #8BC34A); color: white; font-weight: bold; border-radius: 8px; text-decoration: none; font-size: 14px;">‚òï 0,50‚Ç¨</a>
                        <a href="https://paypal.me/lipastudios/2.00" target="_blank" onclick="trackDonationClick('2.00')" style="padding: 12px 20px; background: linear-gradient(45deg, #FF9800, #FFC107); color: white; font-weight: bold; border-radius: 8px; text-decoration: none; font-size: 14px;">üçï 2‚Ç¨</a>
                        <a href="https://paypal.me/lipastudios/5.00" target="_blank" onclick="trackDonationClick('5.00')" style="padding: 12px 20px; background: linear-gradient(45deg, #E91E63, #F06292); color: white; font-weight: bold; border-radius: 8px; text-decoration: none; font-size: 14px;">üéÆ 5‚Ç¨</a>
                    </div>
                </div>
                <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                    <button class="restart-button" onclick="restartGame()">üîÑ PLAY AGAIN</button>
                    <button class="restart-button" onclick="shareScore()" style="background: linear-gradient(45deg, #FF0080, #00FFFF); color: white; border: 3px solid #FFFFFF; font-size: 1.2rem; padding: 15px 25px; box-shadow: 0 0 20px #FF0080;">üì± COMPARTIR VIRAL</button>
                </div>
            </div>
        </div>
        
        <!-- Leaderboard Screen -->
        <div class="game-over-screen" id="leaderboard-screen" style="display: none;">
            <h2 class="game-over-title">üèÜ RANKING DIARIO</h2>
            <div style="max-height: 60vh; overflow-y: auto; margin: 20px 0; padding: 0 20px;">
                <ul id="leaderboard-list" style="list-style: none; padding: 0; margin: 0;">
                    <!-- Leaderboard items will be populated by JavaScript -->
                </ul>
            </div>
            <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                <button class="restart-button" onclick="hideLeaderboard()">üîô VOLVER</button>
            </div>
        </div>
        
        <!-- AdSense Banners (deshabilitados hasta aprobaci√≥n) -->
        <div class="ad-banner top-banner" id="topBanner" style="display: none;"></div>
        <div class="ad-banner bottom-banner" id="bottomBanner" style="display: none;"></div>
        <div class="ad-banner side-banner" id="sideBanner" style="display: none;"></div>
    </div>

    <!-- Global Footer -->
    <footer style="position:relative; z-index:100; background:rgba(0,0,0,0.85); border-top:2px solid #00ffff; padding:16px; text-align:center; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;">
        <div style="max-width:1100px; margin:0 auto; color:#e8f6ff;">
            ¬© <span id="year"></span> LIPA Studios ¬∑ <a href="/privacy.html" style="color:#00ffff;">Privacidad</a> ¬∑ <a href="/terms.html" style="color:#00ffff;">T√©rminos</a> ¬∑ <a href="/contact.html" style="color:#00ffff;">Contacto</a>
        </div>
        <script>document.getElementById('year').textContent = new Date().getFullYear();</script>
    </footer>

    <script>
        // ===== ULTRA OPTIMIZED GAME ENGINE =====
        class UltraOptimizedGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                
                // DETECCI√ìN DE DISPOSITIVO DE GAMA BAJA (SAMSUNG/ANDROID)
                this.isLowEndDevice = this.detectLowEndDevice();
                console.log('üîß Dispositivo de gama baja detectado:', this.isLowEndDevice);
                
                this.gameState = {
                    running: false,
                    score: 0,
                    combo: 1,
                    speed: 4,
                    fps: 60,
                    lastTime: 0,
                    deltaTime: 0
                };
                
                this.runner = {
                    x: 100,
                    y: 0, // Se posicionar√° correctamente en setupCanvas
                    width: 300, // Tama√±o fijo inicial
                    height: 400, // Tama√±o fijo inicial
                    velocityY: 0,
                    velocityX: 0, // Nueva: velocidad horizontal
                    onGround: true,
                    dashCooldown: 0,
                    invulnerable: 0,
                    maxSpeed: 8, // Nueva: velocidad m√°xima horizontal
                    friction: 0.8 // Nueva: fricci√≥n para frenar
                };
                
                this.obstacles = [];
                this.particles = [];
                this.powerUps = [];
                this.gems = [];
                
                this.keys = {};
                this.touch = { active: false, startY: 0 };
                
                this.setupCanvas();
                this.setupEventListeners();
                this.setupAdSense();
                this.gameLoop();
            }
            
            detectLowEndDevice() {
                // Detectar dispositivos Samsung/Android de gama baja
                const userAgent = navigator.userAgent.toLowerCase();
                const isAndroid = /android/.test(userAgent);
                const isSamsung = /samsung/.test(userAgent) || /sm-/.test(userAgent);
                const isLowRAM = navigator.deviceMemory && navigator.deviceMemory < 4; // Menos de 4GB RAM
                const isSlowCPU = navigator.hardwareConcurrency && navigator.hardwareConcurrency < 4; // Menos de 4 cores
                
                // Detectar por User Agent espec√≠ficos de Samsung de gama baja
                const lowEndSamsung = /sm-a|sm-j|sm-g3|sm-g5|sm-g7|sm-g9|sm-t2|sm-t3|sm-t5|sm-t7|sm-p/.test(userAgent);
                
                return (isAndroid && (isSamsung || lowEndSamsung)) || isLowRAM || isSlowCPU;
            }
            
            setupCanvas() {
                // Get viewport dimensions
                const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
                const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
                
                // Set canvas size - SIMPLE Y DIRECTO
                this.canvas.width = vw;
                this.canvas.height = vh;
                this.canvas.style.width = vw + 'px';
                this.canvas.style.height = vh + 'px';
                
                // CORREDOR PEQUE√ëO Y SOBRE EL SUELO
                this.runner.width = 45;   // M√ÅS PEQUE√ëO
                this.runner.height = 60;  // M√ÅS PEQUE√ëO
                this.runner.x = 50;       // M√ÅS A LA IZQUIERDA
                this.runner.y = vh * 0.75; // 75% DE LA PANTALLA (SOBRE EL SUELO)
                
                console.log(`üöÄ CORREDOR GIGANTE: x=${this.runner.x}, y=${this.runner.y}, w=${this.runner.width}, h=${this.runner.height}`);
                console.log(`üìê Canvas: ${vw}x${vh}`);
            }
            
            setupEventListeners() {
                // Keyboard
                document.addEventListener('keydown', (e) => {
                    this.keys[e.code] = true;
                    if (e.code === 'Space') {
                        e.preventDefault();
                        this.jump();
                        console.log('üèÉ‚Äç‚ôÇÔ∏è SPACE pressed - Jump!');
                    } else if (e.code === 'ArrowLeft' || e.code === 'KeyA') {
                        e.preventDefault();
                        this.moveLeft();
                    } else if (e.code === 'ArrowRight' || e.code === 'KeyD') {
                        e.preventDefault();
                        this.moveRight();
                    }
                });
                
                document.addEventListener('keyup', (e) => {
                    this.keys[e.code] = false;
                });
                
                // Touch - mejorado para m√≥vil
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.touch.active = true;
                    this.touch.startY = e.touches[0].clientY;
                    this.jump();
                    console.log('Touch start - Jump!');
                }, { passive: false });
                
                this.canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.touch.active = false;
                }, { passive: false });
                
                // Touch move for horizontal movement
                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    if (this.gameState.gameActive && e.touches.length > 0) {
                        const touch = e.touches[0];
                        const rect = this.canvas.getBoundingClientRect();
                        const touchX = touch.clientX - rect.left;
                        const canvasWidth = this.canvas.width / window.devicePixelRatio;
                        
                        // Move runner based on touch position
                        if (touchX < canvasWidth * 0.3) {
                            this.moveLeft();
                        } else if (touchX > canvasWidth * 0.7) {
                            this.moveRight();
                        }
                    }
                }, { passive: false });
                
                // Touch cancel
                this.canvas.addEventListener('touchcancel', (e) => {
                    e.preventDefault();
                    this.touch.active = false;
                }, { passive: false });
                
                // Mouse
                this.canvas.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.jump();
                    console.log('üñ±Ô∏è CLICK - Jump!');
                });
                
                // Resize
                window.addEventListener('resize', () => {
                    this.setupCanvas();
                });
            }
            
            setupAdSense() {
                try {
                    (adsbygoogle = window.adsbygoogle || []).push({});
                } catch(e) {
                    console.log('AdSense not loaded yet');
                }
            }
            
            jump() {
                if (!this.gameState.running) return;
                
                console.log('üèÉ‚Äç‚ôÇÔ∏è JUMP! - Runner on ground:', this.runner.onGround);
                
                if (this.runner.onGround) {
                    this.runner.velocityY = -12; // Velocidad de salto
                    this.runner.onGround = false;
                    this.createJumpParticles();
                    console.log('‚úÖ Salto ejecutado');
                } else if (this.runner.dashCooldown <= 0) {
                    // Dash ability en el aire
                    this.runner.velocityY = -15;
                    this.runner.dashCooldown = 60; // 1 second at 60fps
                    this.createDashEffect();
                    this.gameState.combo += 2;
                    console.log('‚úÖ Dash ejecutado');
                }
            }
            
            moveLeft() {
                if (!this.gameState.running) return;
                this.runner.velocityX = -this.runner.maxSpeed;
                console.log('Moving left');
            }
            
            moveRight() {
                if (!this.gameState.running) return;
                this.runner.velocityX = this.runner.maxSpeed;
                console.log('Moving right');
            }
            
            createJumpParticles() {
                // OPTIMIZADO PARA SAMSUNG - MENOS PART√çCULAS PERO M√ÅS EFICIENTES
                const particleCount = this.isLowEndDevice ? 8 : 12; // Detectar dispositivo de gama baja
                
                for (let i = 0; i < particleCount; i++) {
                    this.particles.push({
                        x: this.runner.x + this.runner.width / 2,
                        y: this.runner.y + this.runner.height,
                        vx: (Math.random() - 0.5) * 6,
                        vy: Math.random() * 4,
                        life: 30,
                        maxLife: 30,
                        color: this.isLowEndDevice ? '#00FFFF' : `hsl(${180 + Math.random() * 60}, 100%, 70%)`
                    });
                }
                
                // PART√çCULAS ADICIONALES SOLO EN DISPOSITIVOS POTENTES
                if (!this.isLowEndDevice) {
                    for (let i = 0; i < 6; i++) {
                        this.particles.push({
                            x: this.runner.x + this.runner.width / 2,
                            y: this.runner.y + this.runner.height / 2,
                            vx: (Math.random() - 0.5) * 8,
                            vy: (Math.random() - 0.5) * 8,
                            life: 40,
                            maxLife: 40,
                            color: `hsl(${Math.random() * 360}, 100%, 80%)`
                        });
                    }
                }
            }
            
            createDashEffect() {
                // Screen flash effect M√ÅS INTENSO
                this.canvas.style.animation = 'screenShake 0.2s ease-in-out';
                setTimeout(() => {
                    this.canvas.style.animation = '';
                }, 200);
                
                // DASH PARTICLES M√ÅS ESPECTACULARES
                for (let i = 0; i < 30; i++) {
                    this.particles.push({
                        x: this.runner.x + this.runner.width / 2,
                        y: this.runner.y + this.runner.height / 2,
                        vx: (Math.random() - 0.5) * 15, // M√°s velocidad
                        vy: (Math.random() - 0.5) * 15,
                        life: 60, // M√°s duraci√≥n
                        maxLife: 60,
                        color: `hsl(${Math.random() * 360}, 100%, 90%)` // M√°s brillante
                    });
                }
                
                // RAYOS DE ENERG√çA
                for (let i = 0; i < 8; i++) {
                    this.particles.push({
                        x: this.runner.x + this.runner.width / 2,
                        y: this.runner.y + this.runner.height / 2,
                        vx: Math.cos(i * Math.PI / 4) * 20,
                        vy: Math.sin(i * Math.PI / 4) * 20,
                        life: 30,
                        maxLife: 30,
                        color: '#FFFFFF'
                    });
                }
            }
            
            update(deltaTime) {
                if (!this.gameState.running) return;
                
                // F√çSICA DEL CORREDOR - SALTO FUNCIONAL
                const groundY = this.canvas.height * 0.85; // Posici√≥n del suelo
                const groundHeight = this.canvas.height * 0.15; // Altura del suelo
                
                // Aplicar gravedad
                this.runner.velocityY += 0.5; // Gravedad
                this.runner.y += this.runner.velocityY;
                
                // Colisi√≥n con el suelo
                if (this.runner.y + this.runner.height >= groundY) {
                    this.runner.y = groundY - this.runner.height;
                    this.runner.velocityY = 0;
                    this.runner.onGround = true;
                } else {
                    this.runner.onGround = false;
                }
                
                // Horizontal movement
                this.runner.x += this.runner.velocityX;
                this.runner.velocityX *= this.runner.friction; // Fricci√≥n para frenar
                
                // Keep runner within screen bounds
                const margin = 20;
                if (this.runner.x < margin) {
                    this.runner.x = margin;
                    this.runner.velocityX = 0;
                } else if (this.runner.x > this.canvas.width - this.runner.width - margin) {
                    this.runner.x = this.canvas.width - this.runner.width - margin;
                    this.runner.velocityX = 0;
                }
                
                // Update dash cooldown
                if (this.runner.dashCooldown > 0) {
                    this.runner.dashCooldown--;
                }
                
                // Update invulnerability
                if (this.runner.invulnerable > 0) {
                    this.runner.invulnerable--;
                }
                
                // Spawn obstacles - MENOS FRECUENTES
                if (Math.random() < 0.008) { // Reducido de 0.02 a 0.008
                    this.spawnObstacle();
                }
                
                // Spawn power-ups - M√ÅS FRECUENTES PARA COMPENSAR
                if (Math.random() < 0.01) { // Aumentado de 0.005 a 0.01
                    this.spawnPowerUp();
                }
                
                // Spawn gems - M√ÅS FRECUENTES
                if (Math.random() < 0.015) { // Aumentado de 0.01 a 0.015
                    this.spawnGem();
                }
                
                // Update obstacles
                this.obstacles.forEach((obstacle, index) => {
                    obstacle.x -= this.gameState.speed;
                    
                    // Collision detection
                    if (this.checkCollision(this.runner, obstacle)) {
                        if (this.runner.invulnerable <= 0) {
                            this.gameOver();
                        }
                    }
                    
                    // Remove off-screen obstacles
                    if (obstacle.x < -obstacle.width) {
                        this.obstacles.splice(index, 1);
                        this.gameState.score += 10;
                        this.gameState.combo += 1;
                    }
                });
                
                // Update power-ups
                this.powerUps.forEach((powerUp, index) => {
                    powerUp.x -= this.gameState.speed;
                    powerUp.rotation += 0.1;
                    
                    if (this.checkCollision(this.runner, powerUp)) {
                        this.collectPowerUp(powerUp);
                        this.powerUps.splice(index, 1);
                    }
                    
                    if (powerUp.x < -powerUp.width) {
                        this.powerUps.splice(index, 1);
                    }
                });
                
                // Update gems
                this.gems.forEach((gem, index) => {
                    gem.x -= this.gameState.speed;
                    gem.rotation += 0.15;
                    
                    if (this.checkCollision(this.runner, gem)) {
                        this.collectGem(gem);
                        this.gems.splice(index, 1);
                    }
                    
                    if (gem.x < -gem.width) {
                        this.gems.splice(index, 1);
                    }
                });
                
                // Update particles
                this.particles.forEach((particle, index) => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.life--;
                    
                    if (particle.life <= 0) {
                        this.particles.splice(index, 1);
                    }
                });
                
                // Increase speed - PROGRESI√ìN M√ÅS AGRESIVA
                this.gameState.speed += 0.003; // Aumentado de 0.001 a 0.003
                
                // Update score
                this.gameState.score += Math.floor(this.gameState.speed * this.gameState.combo);
            }
            
            spawnObstacle() {
                const types = ['normal', 'tall', 'wide', 'boss'];
                const type = types[Math.floor(Math.random() * types.length)];
                
                const groundY = this.canvas.height * 0.85; // 85% DE LA PANTALLA
                
                let obstacle = {
                    x: this.canvas.width,
                    y: groundY - 30, // POR ENCIMA DEL SUELO
                    width: 30,
                    height: 30,
                    type: type
                };
                
                switch (type) {
                    case 'tall':
                        obstacle.height = 60;
                        obstacle.y = groundY - obstacle.height;
                        break;
                    case 'wide':
                        obstacle.width = 60;
                        obstacle.y = groundY - 30; // POR ENCIMA DEL SUELO
                        break;
                    case 'boss':
                        obstacle.width = 80;
                        obstacle.height = 80;
                        obstacle.y = groundY - obstacle.height;
                        break;
                }
                
                this.obstacles.push(obstacle);
                console.log(`üöß Obst√°culo creado: ${type} en y=${obstacle.y}, suelo=${groundY}`);
            }
            
            spawnPowerUp() {
                const types = ['speed', 'jump', 'shield', 'magnet'];
                const type = types[Math.floor(Math.random() * types.length)];
                
                const groundY = this.canvas.height * 0.85; // 85% DE LA PANTALLA
                
                this.powerUps.push({
                    x: this.canvas.width,
                    y: groundY - 40, // POR ENCIMA DEL SUELO
                    width: 25,
                    height: 25,
                    type: type,
                    rotation: 0
                });
            }
            
            spawnGem() {
                const groundY = this.canvas.height * 0.85; // 85% DE LA PANTALLA
                
                this.gems.push({
                    x: this.canvas.width,
                    y: groundY - 30, // POR ENCIMA DEL SUELO
                    width: 15,
                    height: 15,
                    rotation: 0,
                    value: Math.floor(Math.random() * 5) + 1
                });
            }
            
            checkCollision(rect1, rect2) {
                return rect1.x < rect2.x + rect2.width &&
                       rect1.x + rect1.width > rect2.x &&
                       rect1.y < rect2.y + rect2.height &&
                       rect1.y + rect1.height > rect2.y;
            }
            
            collectPowerUp(powerUp) {
                switch (powerUp.type) {
                    case 'speed':
                        this.gameState.speed += 2;
                        break;
                    case 'jump':
                        this.runner.velocityY = -20;
                        break;
                    case 'shield':
                        this.runner.invulnerable = 180; // 3 seconds
                        break;
                    case 'magnet':
                        // Attract nearby gems
                        this.gems.forEach(gem => {
                            const dx = this.runner.x - gem.x;
                            const dy = this.runner.y - gem.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            if (distance < 100) {
                                gem.x += dx * 0.1;
                                gem.y += dy * 0.1;
                            }
                        });
                        break;
                }
                
                this.createPowerUpEffect(powerUp);
            }
            
            collectGem(gem) {
                this.gameState.score += gem.value * 100 * this.gameState.combo;
                this.createGemEffect(gem);
            }
            
            createPowerUpEffect(powerUp) {
                // EFECTO M√ÅS ESPECTACULAR PARA POWER-UPS
                for (let i = 0; i < 25; i++) {
                    this.particles.push({
                        x: powerUp.x + powerUp.width / 2,
                        y: powerUp.y + powerUp.height / 2,
                        vx: (Math.random() - 0.5) * 12, // M√°s velocidad
                        vy: (Math.random() - 0.5) * 12,
                        life: 60, // M√°s duraci√≥n
                        maxLife: 60,
                        color: `hsl(${120 + Math.random() * 60}, 100%, 80%)` // M√°s brillante
                    });
                }
                
                // EXPLOSI√ìN DE ENERG√çA
                for (let i = 0; i < 12; i++) {
                    this.particles.push({
                        x: powerUp.x + powerUp.width / 2,
                        y: powerUp.y + powerUp.height / 2,
                        vx: Math.cos(i * Math.PI / 6) * 15,
                        vy: Math.sin(i * Math.PI / 6) * 15,
                        life: 40,
                        maxLife: 40,
                        color: '#00FF00'
                    });
                }
            }
            
            createGemEffect(gem) {
                // EFECTO M√ÅS ESPECTACULAR PARA GEMAS
                for (let i = 0; i < 20; i++) {
                    this.particles.push({
                        x: gem.x + gem.width / 2,
                        y: gem.y + gem.height / 2,
                        vx: (Math.random() - 0.5) * 8, // M√°s velocidad
                        vy: (Math.random() - 0.5) * 8,
                        life: 40, // M√°s duraci√≥n
                        maxLife: 40,
                        color: `hsl(${60 + Math.random() * 60}, 100%, 90%)` // M√°s brillante
                    });
                }
                
                // CHISPAS DORADAS
                for (let i = 0; i < 8; i++) {
                    this.particles.push({
                        x: gem.x + gem.width / 2,
                        y: gem.y + gem.height / 2,
                        vx: Math.cos(i * Math.PI / 4) * 10,
                        vy: Math.sin(i * Math.PI / 4) * 10,
                        life: 30,
                        maxLife: 30,
                        color: '#FFD700'
                    });
                }
            }
            
            render() {
                // Clear canvas
                this.ctx.fillStyle = '#000';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Draw background
                this.drawBackground();
                
                // Draw ground
                this.drawGround();
                
                // Draw obstacles
                this.obstacles.forEach(obstacle => this.drawObstacle(obstacle));
                
                // Draw power-ups
                this.powerUps.forEach(powerUp => this.drawPowerUp(powerUp));
                
                // Draw gems
                this.gems.forEach(gem => this.drawGem(gem));
                
                // Draw runner - PRINCIPAL
                this.drawRunner();
                
                // Draw particles
                this.particles.forEach(particle => this.drawParticle(particle));
                
                // Draw UI
                this.drawUI();
            }
            
            drawBackground() {
                // Animated background
                const gradient = this.ctx.createLinearGradient(0, 0, 0, this.canvas.height);
                gradient.addColorStop(0, '#000');
                gradient.addColorStop(0.5, '#111');
                gradient.addColorStop(1, '#000');
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // OPTIMIZADO PARA SAMSUNG - MENOS ESTRELLAS Y C√ÅLCULOS
                const speedMultiplier = Math.min(this.gameState.speed / 4, 3);
                this.ctx.fillStyle = '#00FFFF';
                
                const starCount = this.isLowEndDevice ? 30 : 60; // Menos estrellas en dispositivos de gama baja
                const timeOffset = this.isLowEndDevice ? 
                    Math.floor(Date.now() * 0.01) : // Menos precisi√≥n temporal
                    Date.now() * speedMultiplier * 0.01;
                
                for (let i = 0; i < starCount; i++) {
                    const x = (i * 37 + timeOffset) % this.canvas.width;
                    const y = (i * 23) % this.canvas.height;
                    const size = this.isLowEndDevice ? 2 : (Math.sin(Date.now() * 0.001 + i) * 2 + 2);
                    this.ctx.fillRect(x, y, size, size);
                }
                
                // L√çNEAS DE VELOCIDAD SOLO EN DISPOSITIVOS POTENTES
                if (!this.isLowEndDevice && this.gameState.speed > 8) {
                    this.ctx.strokeStyle = `rgba(0, 255, 255, ${Math.min((this.gameState.speed - 8) / 10, 0.3)})`;
                    this.ctx.lineWidth = 2;
                    for (let i = 0; i < 3; i++) { // Menos l√≠neas
                        const x = (Date.now() * speedMultiplier * 0.02 + i * 300) % this.canvas.width;
                        this.ctx.beginPath();
                        this.ctx.moveTo(x, 0);
                        this.ctx.lineTo(x, this.canvas.height);
                        this.ctx.stroke();
                    }
                }
            }
            
            drawGround() {
                // SUELO ELEGANTE EN LA PARTE INFERIOR
                const groundY = this.canvas.height * 0.85; // 85% DE LA PANTALLA
                const groundHeight = this.canvas.height * 0.15; // 15% DE LA PANTALLA
                
                // Suelo con gradiente elegante
                const gradient = this.ctx.createLinearGradient(0, groundY, 0, groundY + groundHeight);
                gradient.addColorStop(0, '#1a1a2e');
                gradient.addColorStop(0.5, '#16213e');
                gradient.addColorStop(1, '#0f3460');
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, groundY, this.canvas.width, groundHeight);
                
                // L√≠nea superior del suelo - NEON AZUL
                this.ctx.strokeStyle = '#00FFFF';
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();
                this.ctx.moveTo(0, groundY);
                this.ctx.lineTo(this.canvas.width, groundY);
                this.ctx.stroke();
                
                // Efecto de brillo en la l√≠nea
                this.ctx.strokeStyle = '#FFFFFF';
                this.ctx.lineWidth = 1;
                this.ctx.beginPath();
                this.ctx.moveTo(0, groundY);
                this.ctx.lineTo(this.canvas.width, groundY);
                this.ctx.stroke();
                
                // Guardar posici√≥n para f√≠sica
                this.groundY = groundY;
            }
            
            drawRunner() {
                // CORREDOR ELEGANTE Y PROPORCIONADO
                console.log(`üèÉ‚Äç‚ôÇÔ∏è DIBUJANDO CORREDOR: x=${this.runner.x}, y=${this.runner.y}, w=${this.runner.width}, h=${this.runner.height}`);
                
                // Cuerpo del corredor - AZUL NEON
                this.ctx.fillStyle = '#00FFFF';
                this.ctx.fillRect(this.runner.x, this.runner.y, this.runner.width, this.runner.height);
                
                // Cabeza del corredor
                this.ctx.fillStyle = '#FF6B6B';
                this.ctx.fillRect(this.runner.x + 10, this.runner.y, this.runner.width - 20, 30);
                
                // Ojos
                this.ctx.fillStyle = '#FFFFFF';
                this.ctx.fillRect(this.runner.x + 15, this.runner.y + 10, 8, 8);
                this.ctx.fillRect(this.runner.x + 35, this.runner.y + 10, 8, 8);
                
                // Borde del corredor
                this.ctx.strokeStyle = '#FFFFFF';
                this.ctx.lineWidth = 2;
                this.ctx.strokeRect(this.runner.x, this.runner.y, this.runner.width, this.runner.height);
            }
            
            drawObstacle(obstacle) {
                this.ctx.save();
                
                this.ctx.shadowColor = '#FF0000';
                this.ctx.shadowBlur = 15;
                this.ctx.fillStyle = '#FF0000';
                this.ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                
                this.ctx.restore();
            }
            
            drawPowerUp(powerUp) {
                this.ctx.save();
                
                this.ctx.translate(powerUp.x + powerUp.width / 2, powerUp.y + powerUp.height / 2);
                this.ctx.rotate(powerUp.rotation);
                
                this.ctx.shadowColor = '#00FF00';
                this.ctx.shadowBlur = 10;
                this.ctx.fillStyle = '#00FF00';
                this.ctx.fillRect(-powerUp.width / 2, -powerUp.height / 2, powerUp.width, powerUp.height);
                
                this.ctx.restore();
            }
            
            drawGem(gem) {
                this.ctx.save();
                
                this.ctx.translate(gem.x + gem.width / 2, gem.y + gem.height / 2);
                this.ctx.rotate(gem.rotation);
                
                this.ctx.shadowColor = '#FFFF00';
                this.ctx.shadowBlur = 8;
                this.ctx.fillStyle = '#FFFF00';
                this.ctx.fillRect(-gem.width / 2, -gem.height / 2, gem.width, gem.height);
                
                this.ctx.restore();
            }
            
            drawParticle(particle) {
                this.ctx.save();
                
                const alpha = particle.life / particle.maxLife;
                this.ctx.globalAlpha = alpha;
                this.ctx.fillStyle = particle.color;
                this.ctx.fillRect(particle.x, particle.y, 3, 3);
                
                this.ctx.restore();
            }
            
            drawUI() {
                // Score
                document.getElementById('scoreDisplay').textContent = `SCORE: ${this.gameState.score}`;
                
                // Combo
                document.getElementById('comboDisplay').textContent = `COMBO: ${this.gameState.combo}x`;
                
                // FPS
                document.getElementById('fpsDisplay').textContent = `FPS: ${this.gameState.fps}`;
            }
            
            gameOver() {
                this.gameState.running = false;
                document.getElementById('finalScore').textContent = `SCORE: ${this.gameState.score}`;
                document.getElementById('gameOverScreen').style.display = 'flex';
                
                // ESTRATEGIA INTELIGENTE DE MONETIZACI√ìN
                // 1. Siempre mostrar banners en game over (no invasivo)
                showAds();
                
                // 2. Interstitial solo cada 3 partidas perdidas Y cada 5 minutos m√≠nimo
                if (!this.gamesPlayed) this.gamesPlayed = 0;
                if (!this.lastInterstitialTime) this.lastInterstitialTime = 0;
                
                this.gamesPlayed++;
                const currentTime = Date.now();
                const timeSinceLastInterstitial = currentTime - this.lastInterstitialTime;
                const shouldShowInterstitial = (this.gamesPlayed % 3 === 0) && (timeSinceLastInterstitial > 300000); // 5 minutos
                
                if (shouldShowInterstitial) {
                    // Mostrar interstitial
                    const ad = document.getElementById('gameOverAd');
                    if (ad) ad.style.display = 'block';
                    this.lastInterstitialTime = currentTime;
                    
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'ad_impression', {
                            game_name: 'neon_runner_wow',
                            ad_type: 'interstitial'
                        });
                    }
                }
                
                // üèÜ INTEGRACI√ìN DEL LEADERBOARD GLOBAL - MOSTRAR RANKING DESPU√âS DE GAME OVER
                setTimeout(() => {
                    try {
                        // Crear o usar leaderboard global existente
                        if (!window.leaderboard) {
                            window.leaderboard = new UnifiedGlobalLeaderboard('neon-runner-wow');
                        }
                        
                        // Enviar puntuaci√≥n al leaderboard global (esto mostrar√° el prompt de nombre si es necesario)
                        const level = Math.floor(this.gameState.score / 1000) + 1;
                        const success = window.leaderboard.submitScore(this.gameState.score, level, this.gameState.combo);
                        
                        if (success) {
                            console.log(`üèÜ Puntuaci√≥n enviada al leaderboard global: ${this.gameState.score}, nivel: ${level}, combo: ${this.gameState.combo}`);
                        } else {
                            console.log('üèÜ Puntuaci√≥n guardada para env√≠o posterior');
                        }
                    } catch(e) {
                        console.warn('Error en leaderboard global:', e);
                    }
                }, 1000); // Esperar 1 segundo para que se vea la pantalla de game over
                
                // Track game over
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'game_over', {
                        game_name: 'neon_runner_wow',
                        score: this.gameState.score,
                        combo: this.gameState.combo
                    });
                }
            }
            
            gameLoop(currentTime = 0) {
                // Calculate delta time
                this.gameState.deltaTime = currentTime - this.gameState.lastTime;
                this.gameState.lastTime = currentTime;
                
                // Calculate FPS (con l√≠mite para evitar valores extremos)
                if (this.gameState.deltaTime > 0) {
                    this.gameState.fps = Math.min(120, Math.round(1000 / this.gameState.deltaTime));
                }
                
                // OPTIMIZACI√ìN PARA SAMSUNG - SKIP FRAMES SI ES NECESARIO
                if (this.isLowEndDevice && this.gameState.fps < 30) {
                    // En dispositivos de gama baja, actualizar menos frecuentemente
                    if (this.frameSkipCounter === undefined) this.frameSkipCounter = 0;
                    this.frameSkipCounter++;
                    
                    if (this.frameSkipCounter % 2 === 0) { // Skip cada 2 frames
                        this.update(this.gameState.deltaTime * 2);
                        this.render();
                    }
                } else {
                    // Dispositivos normales - renderizado completo
                    this.update(this.gameState.deltaTime);
                    this.render();
                }
                
                // Continue loop
                requestAnimationFrame((time) => this.gameLoop(time));
            }
        }
        
        // ===== GAME FUNCTIONS =====
        let game;
        
        function startGame() {
            document.getElementById('menuScreen').style.display = 'none';
            document.getElementById('gameOverScreen').style.display = 'none';
            
            // Hide ads during gameplay
            hideAds();
            
            // Reinitialize game
            if (game) {
                game.gameState.running = true;
                game.runner.x = 50; // M√ÅS A LA IZQUIERDA
                game.runner.y = window.innerHeight * 0.75; // 75% de la pantalla (sobre el suelo)
                game.runner.velocityY = 0;
                game.runner.onGround = true;
                console.log('üéÆ Game restarted, runner position reset');
            } else {
                game = new UltraOptimizedGame();
                game.gameState.running = true;
                console.log('üéÆ New game created');
            }
            
            // Track game start
            if (typeof gtag !== 'undefined') {
                gtag('event', 'game_start', {
                    game_name: 'neon_runner_wow'
                });
            }
        }
        
        function restartGame() {
            document.getElementById('gameOverScreen').style.display = 'none';
            
            if (game) {
                game.gameState.running = true;
                game.gameState.score = 0;
                game.gameState.combo = 1;
                game.gameState.speed = 4;
                game.obstacles = [];
                game.particles = [];
                game.powerUps = [];
                game.gems = [];
                game.runner.x = 50; // M√ÅS A LA IZQUIERDA
                game.runner.y = window.innerHeight * 0.75; // 75% de la pantalla (sobre el suelo)
                game.runner.velocityY = 0;
                game.runner.onGround = true;
                game.runner.dashCooldown = 0;
                game.runner.invulnerable = 0;
                console.log('üîÑ Game restarted completely');
            }
            
            // Track restart
            if (typeof gtag !== 'undefined') {
                gtag('event', 'game_restart', {
                    game_name: 'neon_runner_wow'
                });
            }
        }
        
        // ===== AD MANAGEMENT =====
        function showAds() {
            // Deshabilitado hasta aprobaci√≥n de AdSense
            console.log('AdSense deshabilitado hasta aprobaci√≥n');
        }
        
        function hideAds() {
            document.getElementById('topBanner').style.display = 'none';
            document.getElementById('bottomBanner').style.display = 'none';
            document.getElementById('sideBanner').style.display = 'none';
            // FORZAR OCULTACI√ìN DEL BANNER LATERAL DURANTE EL JUEGO
            const sideBanner = document.getElementById('sideBanner');
            if (sideBanner) {
                sideBanner.style.display = 'none';
                sideBanner.style.visibility = 'hidden';
            }
        }
        
        // ===== LEADERBOARD FUNCTIONS =====
        
        function showLeaderboard(gameId) {
            try {
                // Crear o usar leaderboard global existente
                if (!window.leaderboard) {
                    window.leaderboard = new UnifiedGlobalLeaderboard('neon-runner-wow');
                }
                
                // Si no hay usuario, pedir nombre primero
                if (!window.leaderboard.currentUser) {
                    window.leaderboard.showNamePrompt(false);
                    // Despu√©s de que el usuario ingrese su nombre, mostrar el ranking
                    setTimeout(() => {
                        if (window.leaderboard.currentUser) {
                            window.leaderboard.showRanking({ 
                                name: window.leaderboard.currentUser.name, 
                                score: window.leaderboard.currentUser.bestScore || 0 
                            });
                        }
                    }, 100);
                } else {
                    // Mostrar ranking directamente
                    window.leaderboard.showRanking({ 
                        name: window.leaderboard.currentUser.name, 
                        score: window.leaderboard.currentUser.bestScore || 0 
                    });
                }
                
                console.log('üèÜ Mostrando leaderboard global del Neon Runner WOW');
            } catch (e) { 
                console.warn('Error al mostrar leaderboard global:', e);
                alert('Error al cargar el ranking global. Int√©ntalo de nuevo.');
            }
        }
        
        function hideLeaderboard() {
            const modal = document.querySelector('[style*="position: fixed"]');
            if (modal) modal.remove();
            document.getElementById('menuScreen').style.display = 'flex';
        }
        
        // ===== INITIALIZATION =====
        window.addEventListener('load', () => {
            console.log('üöÄ Initializing Neon Runner WOW...');
            
            // üèÜ INICIALIZAR LEADERBOARD GLOBAL
            try {
                window.leaderboard = new UnifiedGlobalLeaderboard('neon-runner-wow');
                console.log('‚úÖ Leaderboard global inicializado para Neon Runner WOW');
                console.log('üèÜ Usuario actual:', window.leaderboard.currentUser);
                console.log('üèÜ Ranking actual:', window.leaderboard.leaderboard);
            } catch (e) {
                console.warn('Error al inicializar leaderboard global:', e);
            }
            
            // TEST INMEDIATO DEL CANVAS
            const testCanvas = document.getElementById('gameCanvas');
            if (testCanvas) {
                console.log('‚úÖ Canvas encontrado:', testCanvas);
                const testCtx = testCanvas.getContext('2d');
                if (testCtx) {
                    console.log('‚úÖ Context obtenido:', testCtx);
                    
                    // Test b√°sico de dibujo
                    testCtx.fillStyle = '#FF0000';
                    testCtx.fillRect(0, 0, 100, 100);
                    testCtx.fillStyle = '#FFFFFF';
                    testCtx.font = '20px Arial';
                    testCtx.fillText('TEST CANVAS', 10, 50);
                    console.log('‚úÖ Test de dibujo completado');
                } else {
                    console.error('‚ùå No se pudo obtener context del canvas');
                }
            } else {
                console.error('‚ùå Canvas no encontrado');
            }
            
            // Initialize game
            game = new UltraOptimizedGame();
            
            // Initialize global leaderboard
            setTimeout(() => {
                try { 
                    window.leaderboard = new UnifiedGlobalLeaderboard('neon-runner-wow'); 
                } catch(e) { 
                    console.warn('Global leaderboard init error', e); 
                }
            }, 100);
            
            // Show ads in menu
            showAds();
            
            // Track page view
            if (typeof gtag !== 'undefined') {
                gtag('event', 'page_view', {
                    game_name: 'neon_runner_wow'
                });
            }
            
            // Initialize AdSense
            // AdSense deshabilitado
            
            console.log('‚úÖ Neon Runner WOW initialized successfully!');
        });
        
        // Handle resize
        window.addEventListener('resize', () => {
            if (game) {
                game.setupCanvas();
            }
        });
        
        // ===== SHARE FUNCTIONS =====
        function shareScore() {
            const score = game ? game.gameState.score : 0;
            const combo = game ? game.gameState.combo : 1;
            const level = Math.floor(score / 1000) + 1;
            
            // Obtener informaci√≥n del leaderboard si est√° disponible
            let rankInfo = '';
            if (window.leaderboard && window.leaderboard.currentUser) {
                const userRank = window.leaderboard.getUserRank();
                const badgesCount = window.leaderboard.badges.length;
                rankInfo = `\nüèÜ Ranking: #${userRank || 'No clasificado'}\nüèÖ Badges: ${badgesCount}`;
            }
            
            const shareText = `üèÉ‚Äç‚ôÇÔ∏è ¬°Acabo de conseguir ${score.toLocaleString()} puntos en Neon Runner WOW! üéÆ\n\nüî• Combo: ${combo}x\nüéØ Nivel: ${level}${rankInfo}\n\nüöÄ ¬°Juega t√∫ tambi√©n en https://runnerwow.netlify.app!\n\n#NeonRunnerWOW #LIPAStudios #JuegosNeon`;
            
            // Intentar compartir nativo
            if (navigator.share) {
                navigator.share({
                    title: 'Neon Runner WOW - Mi Puntuaci√≥n',
                    text: shareText,
                    url: 'https://runnerwow.netlify.app'
                }).then(() => {
                    console.log('‚úÖ Compartido exitosamente');
                    // Track sharing event
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'share', {
                            method: 'native',
                            content_type: 'game_score',
                            score: score
                        });
                    }
                }).catch((error) => {
                    console.log('Error al compartir:', error);
                    fallbackShare(shareText);
                });
            } else {
                fallbackShare(shareText);
            }
        }
        
        // Fallback para compartir
        function fallbackShare(text) {
            // Copiar al portapapeles
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    alert('üìã ¬°Texto copiado! Pega en tu red social favorita');
                    // Track sharing event
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'share', {
                            method: 'clipboard',
                            content_type: 'game_score',
                            score: game ? game.score : 0
                        });
                    }
                }).catch(() => {
                    // Fallback manual
                    prompt('üìã Copia este texto para compartir:', text);
                });
            } else {
                // Fallback manual
                prompt('üìã Copia este texto para compartir:', text);
            }
        }
    </script>
    
    <!-- MONETAG MULTI TAG -->
    <script src="https://fpyf8.com/88/tag.min.js" data-zone="176544" async data-cfasync="false"></script>
</body>
</html>
